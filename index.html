<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mi Tarik Menu</title>
  <style>
    body { font-family: Arial; padding: 20px; background: #fefefe; }
    h1, h2 { color: #6b240c; }
    .menu { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 16px; }
    .item, .order-card { border: 1px solid #ccc; border-radius: 8px; padding: 10px; background: #fff; }
    .item img { width: 100%; border-radius: 8px; }
    .cart { margin-top: 20px; border-top: 2px solid #6b240c; padding-top: 10px; }
    .admin, .admin-panel, .orders { margin-top: 40px; border-top: 2px dashed #999; padding-top: 20px; }
    button { background: #6b240c; color: white; border: none; padding: 8px 16px; cursor: pointer; border-radius: 4px; }
    input, select { padding: 6px; margin: 4px; }
  </style>
</head>
<body>
  <h1>üçú Mi Tarik Menu</h1>
  <div id="menu" class="menu"></div>

  <div class="cart">
    <h2>Your Cart</h2>
    <ul id="cart-list"></ul>
    <p>Total: RM <span id="total">0.00</span></p>
    <button onclick="submitOrder()">Place Order</button>
  </div>

  <div class="admin">
    <h2>üîê Admin Login</h2>
    <input type="password" id="admin-password" placeholder="Enter password" />
    <button onclick="checkAdmin()">Login</button>
  </div>

  <div class="admin-panel" id="admin-panel" style="display: none;">
    <h2>üßë‚Äçüç≥ Admin Panel</h2>
    <p><b>Add New Menu Item:</b></p>
    <input id="new-name" placeholder="Name" />
    <input id="new-price" placeholder="Price" type="number" />
    <input id="new-img" placeholder="Image URL" />
    <button onclick="addMenuItem()">Add Item</button>

    <div class="orders">
      <h2>üì¶ Orders</h2>
      <div id="orders-list"></div>
    </div>
  </div>

<script>
const api = 'https://mi-tarik-server.onrender.com';
let cart = [];

function fetchMenu() {
  fetch(`${api}/menu`)
    .then(res => res.json())
    .then(data => {
      const menuDiv = document.getElementById('menu');
      menuDiv.innerHTML = '';
      data.forEach(item => {
        const card = document.createElement('div');
        card.className = 'item';
        card.innerHTML = `
          <img src="${item.image_url}" alt="${item.name}" />
          <h3>${item.name}</h3>
          <p>RM ${item.price.toFixed(2)}</p>
          <button onclick='addToCart(${JSON.stringify(item)})'>Add to Cart</button>
        `;
        menuDiv.appendChild(card);
      });
    }).catch(err => alert('‚ùå Failed to load menu'));
}

function addToCart(item) {
  cart.push(item);
  updateCart();
}

function updateCart() {
  const list = document.getElementById('cart-list');
  const total = document.getElementById('total');
  list.innerHTML = '';
  let sum = 0;
  cart.forEach(item => {
    list.innerHTML += `<li>${item.name} - RM ${item.price.toFixed(2)}</li>`;
    sum += item.price;
  });
  total.textContent = sum.toFixed(2);
}

function submitOrder() {
  if (cart.length === 0) return alert('üõí Your cart is empty!');
  const name = prompt('Enter your name:');
  if (!name) return;
  fetch(`${api}/order`, {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({
      name: name,
      type: 'Website',
      items: cart,
      total: cart.reduce((s, i) => s + i.price, 0)
    })
  })
  .then(res => res.json())
  .then(res => {
    alert('‚úÖ Order placed!');
    cart = [];
    updateCart();
  }).catch(err => alert('‚ùå Failed to submit order.'));
}

function checkAdmin() {
  const pw = document.getElementById('admin-password').value;
  if (pw === 'admin123') {
    document.getElementById('admin-panel').style.display = 'block';
    fetchOrders();
  } else {
    alert('Wrong password');
  }
}

function fetchOrders() {
  fetch(`${api}/orders`)
    .then(res => res.json())
    .then(data => {
      const ol = document.getElementById('orders-list');
      ol.innerHTML = '';
      data.forEach((o, i) => {
        const card = document.createElement('div');
        card.className = 'order-card';
        card.innerHTML = `
          <h4>Order ${i + 1} - ${o.name} (${o.type})</h4>
          <ul>${o.items.map(it => `<li>${it.name} - RM ${it.price.toFixed(2)}</li>`).join('')}</ul>
          <p><b>Total:</b> RM ${o.total.toFixed(2)}</p>
        `;
        ol.appendChild(card);
      });
    });
}

function addMenuItem() {
  const name = document.getElementById('new-name').value;
  const price = parseFloat(document.getElementById('new-price').value);
  const image_url = document.getElementById('new-img').value;
  if (!name || isNaN(price) || !image_url) return alert('Please fill all fields');

  fetch(`${api}/menu`)
    .then(res => res.json())
    .then(menu => {
      const newItem = {
        id: menu.length + 1,
        name, price, image_url
      };
      return fetch(`${api}/menu`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(newItem)
      });
    })
    .then(res => res.json())
    .then(() => {
      alert('‚úÖ Menu item added!');
      fetchMenu();
    })
    .catch(err => alert('‚ùå Failed to add item.'));
}

fetchMenu();
</script>
</body>
</html>
